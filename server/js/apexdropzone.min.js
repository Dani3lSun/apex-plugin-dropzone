var apexDropzone={parseBoolean:function(b){var a;"true"==b.toLowerCase()&&(a=!0);"false"==b.toLowerCase()&&(a=!1);"true"!=b.toLowerCase()&&"false"!=b.toLowerCase()&&(a=void 0);return a},imageExists:function(b,a,d){try{var c=new Image;c.onload=a;c.onerror=d;c.src=b}catch(g){console.log(g)}},clob2Array:function(b,a,d){loopCount=Math.floor(b.length/a)+1;for(var c=0;c<loopCount;c++)d.push(b.slice(a*c,a*(c+1)));return d},binaryArray2base64:function(b){var a="";b=new Uint8Array(b);for(var d=b.byteLength,
c=0;c<d;c++)a+=String.fromCharCode(b[c]);return btoa(a)},sleep_until:function(b){for(var a=(new Date).getTime();new Date<a+b;);return!0},doCallback:function(b){"function"===typeof b&&b()},setUploadProgress:function(b,a,d){b||(b=window.event);b.lengthComputable&&(b=b.loaded/b.total*100,a.emit("uploadprogress",d,b,d.size/(100/b)))},apexDropzoneFnc:function(b,a,d){var c=jQuery("#"+apex.util.escapeCSS(b+"_dropzone"),apex.gPageContext$),g=apex.util.escapeCSS(b+"_dropzone");d=apexDropzone.parseBoolean(d);
var k=apexDropzone.parseBoolean(a.clickable),l=parseInt(a.maxFilesize),m=apexDropzone.parseBoolean(a.removeAfterUpload),n=parseInt(a.maxFiles),p=apexDropzone.parseBoolean(a.supportCopyPaste),h=parseInt(a.waitTime),q=parseInt(a.parallelUploads),r=apexDropzone.parseBoolean(a.commonFilePreview);d&&(console.log("dropzoneApex: vOptions.ajaxIdentifier:",a.ajaxIdentifier),console.log("dropzoneApex: vOptions.pageItems:",a.pageItems),console.log("dropzoneApex: vOptions.maxFilesize:",a.maxFilesize),console.log("dropzoneApex: vOptions.clickable:",
a.clickable),console.log("dropzoneApex: vOptions.removeAfterUpload:",a.removeAfterUpload),console.log("dropzoneApex: vOptions.defaultMessage:",a.defaultMessage),console.log("dropzoneApex: vOptions.acceptedFiles:",a.acceptedFiles),console.log("dropzoneApex: vOptions.maxFiles:",a.maxFiles),console.log("dropzoneApex: vOptions.parallelUploads:",a.parallelUploads),console.log("dropzoneApex: vOptions.refreshRegionID:",a.refreshRegionID),console.log("dropzoneApex: vOptions.supportCopyPaste:",a.supportCopyPaste),
console.log("dropzoneApex: vOptions.waitTime:",a.waitTime),console.log("dropzoneApex: vOptions.commonFilePreview:",a.commonFilePreview),console.log("dropzoneApex: vOptions.callbackEvent:",a.callbackEvent),console.log("dropzoneApex: vOptions.callbackFnc:",a.callbackFnc),console.log("dropzoneApex: vOptions.pluginPrefix:",a.pluginPrefix),console.log("dropzoneApex: vOptions.fileTooBigMessage:",a.fileTooBigMessage),console.log("dropzoneApex: vOptions.maxFilesMessage:",a.maxFilesMessage),console.log("dropzoneApex: pRegionId:",
b),console.log("dropzoneApex: vRegion:",g),console.log("dropzoneApex: vRegion$:",c));Dropzone.autoDiscover=!1;var e=new Dropzone("div#"+g,{paramName:"p_clob_01",url:"wwv_flow.show",params:{p_instance:$v("pInstance"),p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId")},addRemoveLinks:!1,parallelUploads:q,uploadMultiple:!1,autoProcessQueue:!0,maxFilesize:l,dictDefaultMessage:a.defaultMessage,clickable:k,maxFiles:n,acceptedFiles:a.acceptedFiles,dictFileTooBig:a.fileTooBigMessage,dictMaxFilesExceeded:a.maxFilesMessage});
k||$(".dz-hidden-input").prop("disabled",!0);p&&FileReaderJS.setupClipboard(document.body,{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(a,b){e.addFile(b)}}});e.on("addedfile",function(e){$("#"+b).trigger("dropzone-added-file");if(r&&!e.type.match(/image.*/)){var c=e.name.split(".").pop();apexDropzone.imageExists(a.pluginPrefix+"img/"+c+".png",function(){$(e.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/"+c+".png")},function(){$(e.previewElement).find(".dz-image img").attr("src",
a.pluginPrefix+"img/other.png")})}if("ADDEDFILE"==a.callbackEvent)try{var f="return "+a.callbackFnc.replace(/;+$/,"")+";",d=(new Function(f))();apexDropzone.doCallback(d(e))}catch(g){console.log(g)}});e.uploadFiles=function(b){for(var c=0;c<b.length;c++){var f=b[c],d=new FileReader;d.onload=function(b){return function(c){if(b){c=apexDropzone.binaryArray2base64(c.target.result);var d=[],d=apexDropzone.clob2Array(c,3E4,d);e.emit("uploadprogress",f,10,f.size/10);apex.server.plugin(a.ajaxIdentifier,{x01:f.name,
x02:f.type,f01:d,pageItems:a.pageItems},{dataType:"html",success:function(){apexDropzone.sleep_until(h);e.emit("uploadprogress",f,100,f.size);f.status=Dropzone.SUCCESS;e.emit("success",f,"success",null);e.emit("complete",f);e.processQueue()},error:function(a,b){apexDropzone.sleep_until(h);f.status=Dropzone.ERROR;e.emit("error",f,null===b||void 0===b?"Error processing file.":b,a);e.emit("complete",f);e.processQueue()},xhr:function(){XhrObj=$.ajaxSettings.xhr();XhrObj.upload?XhrObj.upload.addEventListener("progress",
function(a){apexDropzone.setUploadProgress(a,e,f)},!1):console.log("Upload progress is not supported.");return XhrObj}})}else apexDropzone.sleep_until(h),e.processQueue()}}(f);d.readAsArrayBuffer(f)}};e.on("complete",function(){if(0===e.getQueuedFiles().length&&0===e.getUploadingFiles().length){$("#"+b).trigger("dropzone-upload-complete");if("COMPLETE"==a.callbackEvent)try{var c="return "+a.callbackFnc.replace(/;+$/,"")+";",d=(new Function(c))();apexDropzone.doCallback(d())}catch(f){console.log(f)}m&&
setTimeout(function(){e.removeAllFiles()},3E3);a.refreshRegionID&&setTimeout(function(){apex.event.trigger("#"+a.refreshRegionID,"apexrefresh")},2E3)}})}};
