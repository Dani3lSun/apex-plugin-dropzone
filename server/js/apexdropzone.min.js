var apexDropzone={parseBoolean:function(e){var o;return"true"==e.toLowerCase()&&(o=!0),"false"==e.toLowerCase()&&(o=!1),"true"!=e.toLowerCase()&&"false"!=e.toLowerCase()&&(o=void 0),o},imageExists:function(e,o,r){try{var a=new Image;a.onload=o,a.onerror=r,a.src=e}catch(e){apex.debug.log("apexDropzone.imageExists Error",e)}},clob2Array:function(e,o,r){loopCount=Math.floor(e.length/o)+1;for(var a=0;a<loopCount;a++)r.push(e.slice(o*a,o*(a+1)));return r},binaryArray2base64:function(e){for(var o="",r=new Uint8Array(e),a=r.byteLength,n=0;n<a;n++)o+=String.fromCharCode(r[n]);return btoa(o)},setUploadProgress:function(e,o,r){var a;e?(a=e.loaded/e.total*100,a>100&&(a=100),r.upload={progress:a,total:e.total,bytesSent:e.loaded}):(a=100,r.upload={progress:a,bytesSent:r.upload.total}),o.emit("uploadprogress",r,a,r.size/(100/a))},setUploadProgressChunked:function(e,o,r,a,n){var p;e?(p=r/a*100,p+=e.loaded/e.total*100/a,p>100&&(p=100),n.upload={progress:p,total:e.total*(r/a),bytesSent:e.loaded*(r/a)}):(p=100*(r/a),p>100&&(p=100),n.upload={progress:p,bytesSent:n.upload.total*(r/a)}),o.emit("uploadprogress",n,p,n.size/(100/p))},asyncLoop:function(e,o,r){var a=1,n=!1,p={next:function(){n||(a<=e?(a++,o(p)):(n=!0,r()))},iteration:function(){return a-1},stop:function(){n=!0,r()}};return p.next(),p},processFile:function(e,o,r){if((e.options.resizeWidth||e.options.resizeHeight)&&o.type.match(/image.*/)){var a=e.options.resizeMethod;a=e.options.resizeWidth&&e.options.resizeHeight?"crop":"contain",e.resizeImage(o,e.options.resizeWidth,e.options.resizeHeight,a,function(e){e.name=o.name,e.status=o.status,e.accepted=o.accepted,e.processing=o.processing,e.lastModified=o.lastModified,e.lastModifiedDate=o.lastModifiedDate,e.previewElement=o.previewElement,e.previewTemplate=o.previewTemplate,e._removeLink=o._removeLink,r(e)})}else r(o)},uploadDzFiles:function(e,o,r,a){for(var n=0;n<a.length;n++){var p=a[n];apexDropzone.processFile(r,a[n],function(a){if(a){var n=p;p=a}var l=new FileReader;l.onload=function(l){return function(t){if(l){a&&(p=n);var s=apexDropzone.binaryArray2base64(t.target.result),i=[];i=apexDropzone.clob2Array(s,3e4,i),r.emit("uploadprogress",p,10,p.size/10),p.xhr=apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",x02:p.name,x03:p.type,f01:i,p_request:"PLUGIN="+o,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(o){var a;try{a=jQuery.parseJSON(o)}catch(e){apex.debug.log("apexDropzone.uploadDzFiles Response ParseError",e),a=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFiles Response ParseError", "code": "AJAX Callback (pData) ParseError" }')}"error"==a.status?(apex.debug.log("apexDropzone.uploadDzFiles Error",a.message,a.code),apex.event.trigger("#"+e,"dropzone-upload-error",a),p.status=Dropzone.ERROR,r.emit("error",p,"Database error during file upload")):"success"==a.status&&(p.id=a.id,apex.debug.log("apexDropzone.uploadDzFiles Success",a.message),apex.event.trigger("#"+e,"dropzone-upload-success",o),p.status=Dropzone.SUCCESS,r.emit("success",p,"success",null)),r.emit("uploadprogress",p,100,p.size),r.emit("complete",p),r.processQueue()},error:function(o,a){apex.debug.log("apexDropzone.uploadDzFiles Error",a),apex.event.trigger("#"+e,"dropzone-upload-error",a),p.status=Dropzone.ERROR;var n="";n=a?a:"Error processing file",r.emit("error",p,n,o),r.emit("complete",p),r.processQueue()},xhr:function(){return XhrObj=$.ajaxSettings.xhr(),XhrObj.upload?XhrObj.upload.addEventListener("progress",function(e){apexDropzone.setUploadProgress(e,r,p)},!1):apex.debug.log("apexDropzone.uploadDzFiles XHR","Upload progress is not supported."),XhrObj}})}else r.processQueue()}}(p),l.readAsArrayBuffer(p)})}},uploadDzFilesChunked:function(e,o,r,a,n){for(var p=0;p<a.length;p++){var l,t=a[p];apexDropzone.processFile(r,a[p],function(a){a&&(l=t,t=a);var p=new FileReader;p.onload=function(p){return function(s){if(p){var i,d,u,g,c,x=n||1048576,z=Math.ceil(t.size/x);apexDropzone.asyncLoop(z,function(n){u=n.iteration(),g=x*(u-1),c=g+x,apex.debug.log(t.name+" currentChunk",u),apex.debug.log(t.name+" chunkStart",g),apex.debug.log(t.name+" chunkEnd",c),i=t.slice(g,c);var p=new FileReader;p.onload=function(p){return function(p){d=apexDropzone.binaryArray2base64(p.target.result),t.xhr=apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",x02:t.name,x03:t.type,x04:u,x05:z,p_clob_01:d,p_request:"PLUGIN="+o,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(o){a&&(t=l);var p;try{p=jQuery.parseJSON(o)}catch(e){apex.debug.log("apexDropzone.uploadDzFilesChunked Response ParseError",e),p=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFilesChunked Response ParseError", "code": "AJAX Callback (pData) ParseError" }')}"error"==p.status?(apex.debug.log("apexDropzone.uploadDzFilesChunked Error",p.message,p.code),apex.event.trigger("#"+e,"dropzone-upload-chunk-error",p),t.status=Dropzone.ERROR,r.emit("error",t,"Database error during file upload"),r.emit("complete",t),r.processQueue()):"success"==p.status&&(apex.debug.log("apexDropzone.uploadDzFilesChunked Success",p.message),apex.event.trigger("#"+e,"dropzone-upload-chunk-success",o),u==z&&(t.id=p.id,t.status=Dropzone.SUCCESS,r.emit("success",t,"success",null),r.emit("complete",t),r.processQueue())),a&&(t=a),n.next()},error:function(o,n){a&&(t=l),apex.debug.log("apexDropzone.uploadDzFilesChunked Error",n),apex.event.trigger("#"+e,"dropzone-upload-chunk-error",n),t.status=Dropzone.ERROR;var p="";p=n?n:"Error processing file",r.emit("error",t,p,o),r.emit("complete",t),r.processQueue()},xhr:function(){return XhrObj=$.ajaxSettings.xhr(),XhrObj.upload?XhrObj.upload.addEventListener("progress",function(e){apexDropzone.setUploadProgressChunked(e,r,u,z,l||t)},!1):apex.debug.log("apexDropzone.uploadDzFilesChunked XHR","Upload progress is not supported."),XhrObj}})}}(i),p.readAsArrayBuffer(i)},function(){apex.debug.log("apexDropzone.uploadDzFilesChunked Loop ended")})}else r.processQueue()}}(t),p.readAsArrayBuffer(t)})}},deleteDzFile:function(e,o,r,a){apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"DELETE",x02:a.name,x03:a.id,p_request:"PLUGIN="+o,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(o){var r;try{r=jQuery.parseJSON(o)}catch(e){apex.debug.log("apexDropzone.deleteDzFile Response ParseError",e),r=jQuery.parseJSON('{ "status": "error", "message": "deleteDzFile Response ParseError", "code": "AJAX Callback (pData) ParseError" }')}"error"==r.status?(apex.debug.log("apexDropzone.deleteDzFile Error",r.message,r.code),apex.event.trigger("#"+e,"dropzone-delete-error",r)):"success"==r.status&&(apex.debug.log("apexDropzone.deleteDzFile Success",r.message),apex.event.trigger("#"+e,"dropzone-delete-success",o))},error:function(o,r){apex.debug.log("apexDropzone.deleteDzFile Error",r),apex.event.trigger("#"+e,"dropzone-delete-error",r)}})},handlePluginEvents:function(e,o){e.on("removedfile",function(e){apex.debug.log("apexDropzone.handlePluginEvents - removedfile event"),apex.event.trigger("#"+o,"dropzone-deleted-file",e)}),e.on("addedfile",function(e){apex.debug.log("apexDropzone.handlePluginEvents - addedfile event"),apex.event.trigger("#"+o,"dropzone-added-file",e)}),e.on("maxfilesexceeded",function(e){apex.debug.log("apexDropzone.handlePluginEvents - maxfilesexceeded event"),apex.event.trigger("#"+o,"dropzone-maxfiles-exceeded",e)}),e.on("totaluploadprogress",function(e){apex.debug.log("apexDropzone.handlePluginEvents - totaluploadprogress event"),apex.event.trigger("#"+o,"dropzone-totalupload-progress",e)}),e.on("dragenter",function(){apex.debug.log("apexDropzone.handlePluginEvents - dragenter event"),apex.event.trigger("#"+o,"dropzone-drag-over")}),e.on("error",function(e,r){apex.debug.log("apexDropzone.handlePluginEvents - error event"),e.errorMessage=r,apex.event.trigger("#"+o,"dropzone-file-error",e)}),e.on("complete",function(){0===e.getQueuedFiles().length&&0===e.getUploadingFiles().length&&(apex.debug.log("apexDropzone.handlePluginEvents - complete event"),apex.event.trigger("#"+o,"dropzone-upload-complete"))})},pluginHandler:function(e,o){var r=jQuery("#"+apex.util.escapeCSS(e+"_dropzone"),apex.gPageContext$),a=apex.util.escapeCSS(e+"_dropzone"),n=o.ajaxIdentifier,p=parseFloat(o.maxFilesize),l=parseInt(o.maxFiles),t=o.acceptedFiles,s=o.uploadMechanism,i=apexDropzone.parseBoolean(o.clickable),d=apexDropzone.parseBoolean(o.showFilePreview),u=apexDropzone.parseBoolean(o.supportCopyPaste),g=apexDropzone.parseBoolean(o.removeAfterUpload),c=apexDropzone.parseBoolean(o.deleteFiles),x=apexDropzone.parseBoolean(o.resizeImages),z=parseInt(o.resizeWidth),f=parseInt(o.resizeHeight),D=o.pluginPrefix,v=parseInt(o.chunkSize),b=o.displayMessage,m=o.fallbackMessage,h=o.fileTooBigMessage,F=o.maxFilesMessage,w=o.removeFileMessage,y=o.cancelUploadMessage,E=o.cancelUploadConfirmMessage,P=o.invalidFileTypeMessage;apex.debug.log("apexDropzone.pluginHandler - pRegionId",e),apex.debug.log("apexDropzone.pluginHandler - pOptions",o),apex.debug.log("apexDropzone.pluginHandler - region",a),apex.debug.log("apexDropzone.pluginHandler - region$",r),apex.debug.log("apexDropzone.pluginHandler - ajaxIdentifier",n),apex.debug.log("apexDropzone.pluginHandler - maxFileSize",p),apex.debug.log("apexDropzone.pluginHandler - maxFiles",l),apex.debug.log("apexDropzone.pluginHandler - acceptedFiles",t),apex.debug.log("apexDropzone.pluginHandler - uploadMechanism",s),apex.debug.log("apexDropzone.pluginHandler - clickable",i),apex.debug.log("apexDropzone.pluginHandler - showFilePreview",d),apex.debug.log("apexDropzone.pluginHandler - supportCopyPaste",u),apex.debug.log("apexDropzone.pluginHandler - removeAfterUpload",g),apex.debug.log("apexDropzone.pluginHandler - deleteFiles",c),apex.debug.log("apexDropzone.pluginHandler - resizeImages",x),apex.debug.log("apexDropzone.pluginHandler - resizeWidth",z),apex.debug.log("apexDropzone.pluginHandler - resizeHeight",f),apex.debug.log("apexDropzone.pluginHandler - pluginPrefix",D),apex.debug.log("apexDropzone.pluginHandler - chunkSize",v),apex.debug.log("apexDropzone.pluginHandler - displayMessage",b),apex.debug.log("apexDropzone.pluginHandler - fallbackMessage",m),apex.debug.log("apexDropzone.pluginHandler - fileTooBigMessage",h),apex.debug.log("apexDropzone.pluginHandler - maxFilesMessage",F),apex.debug.log("apexDropzone.pluginHandler - removeFileMessage",w),apex.debug.log("apexDropzone.pluginHandler - cancelUploadMessage",y),apex.debug.log("apexDropzone.pluginHandler - cancelUploadConfirmMessage",E),apex.debug.log("apexDropzone.pluginHandler - invalidFileTypeMessage",P);var C,H;x?(C=z||null,H=f||null):(C=null,H=null);var S={url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",uploadMultiple:!1,autoProcessQueue:!0,parallelUploads:1,addRemoveLinks:c,maxFilesize:p,clickable:i,maxFiles:l,acceptedFiles:t,resizeWidth:C,resizeHeight:H,dictDefaultMessage:b,dictFallbackMessage:m,dictFileTooBig:h,dictMaxFilesExceeded:F,dictRemoveFile:w,dictCancelUpload:y,dictCancelUploadConfirmation:E,dictInvalidFileType:P};Dropzone.autoDiscover=!1;var _=new Dropzone("div#"+a,S);i||$(".dz-hidden-input").prop("disabled",!0),u&&FileReaderJS.setupClipboard(document.body,{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(e,o){_.addFile(o)}}}),_.uploadFiles=function(o){"NORMAL"==s?apexDropzone.uploadDzFiles(e,n,_,o):"CHUNKED"==s&&apexDropzone.uploadDzFilesChunked(e,n,_,o,v)},apexDropzone.handlePluginEvents(_,e),c&&_.on("removedfile",function(o){apexDropzone.deleteDzFile(e,n,_,o)}),_.on("addedfile",function(e){if(d&&!e.type.match(/image.*/)){var r=e.name.split(".").pop(),a=o.pluginPrefix+"img/"+r+".png";apexDropzone.imageExists(a,function(){$(e.previewElement).find(".dz-image img").attr("src",o.pluginPrefix+"img/"+r+".png")},function(){$(e.previewElement).find(".dz-image img").attr("src",o.pluginPrefix+"img/other.png")})}}),_.on("complete",function(){0===_.getQueuedFiles().length&&0===_.getUploadingFiles().length&&g&&setTimeout(function(){_.removeAllFiles()},3e3)})}};