var apexDropzone={parseBoolean:function(b){var a;"true"==b.toLowerCase()&&(a=!0);"false"==b.toLowerCase()&&(a=!1);"true"!=b.toLowerCase()&&"false"!=b.toLowerCase()&&(a=void 0);return a},imageExists:function(b,a,c){try{var d=new Image;d.onload=a;d.onerror=c;d.src=b}catch(h){console.log(h)}},clob2Array:function(b,a,c){loopCount=Math.floor(b.length/a)+1;for(var d=0;d<loopCount;d++)c.push(b.slice(a*d,a*(d+1)));return c},binaryArray2base64:function(b){var a="";b=new Uint8Array(b);for(var c=b.byteLength,
d=0;d<c;d++)a+=String.fromCharCode(b[d]);return btoa(a)},sleepUntil:function(b){for(var a=(new Date).getTime();new Date<a+b;);return!0},doCallback:function(b){"function"===typeof b&&b()},setUploadProgress:function(b,a,c){b||(b=window.event);b.lengthComputable&&(b=b.loaded/b.total*100,a.emit("uploadprogress",c,b,c.size/(100/b)))},buildPageItemsArray:function(b){var a=[];b=b.replace(/#/g,"");return a=b.split(",")},buildPageItemValuesArray:function(b){for(var a=[],c=0;c<b.length;c++)a.push($v(b[c]));
return a},uploadDzFiles:function(b,a,c,d,h,g){var k=[],m=[];d&&(k=apexDropzone.buildPageItemsArray(d),m=apexDropzone.buildPageItemValuesArray(k));for(d=0;d<c.length;d++){var e=c[d],n=new FileReader;n.onload=function(d){return function(c){if(d){c=apexDropzone.binaryArray2base64(c.target.result);var l=[],l=apexDropzone.clob2Array(c,3E4,l);a.emit("uploadprogress",e,10,e.size/10);apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",
async:!0,traditional:!0,data:{x01:"UPLOAD",x02:e.name,x03:e.type,f01:l,p_arg_names:k,p_arg_values:m,p_request:"PLUGIN="+h,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(c){apexDropzone.sleepUntil(g);0<=c.indexOf("sqlerrm")?(apex.event.trigger("#"+b,"dropzone-upload-error",c),e.status=Dropzone.ERROR,a.emit("error",e,"Database error during file upload")):(apex.event.trigger("#"+b,"dropzone-upload-success",c),e.status=Dropzone.SUCCESS,
a.emit("success",e,"success",null));a.emit("uploadprogress",e,100,e.size);a.emit("complete",e);a.processQueue()},error:function(c,d){apexDropzone.sleepUntil(g);apex.event.trigger("#"+b,"dropzone-upload-error",d);e.status=Dropzone.ERROR;a.emit("error",e,d?d:"Error processing file",c);a.emit("complete",e);a.processQueue()},xhr:function(){XhrObj=$.ajaxSettings.xhr();XhrObj.upload?XhrObj.upload.addEventListener("progress",function(b){apexDropzone.setUploadProgress(b,a,e)},!1):console.log("Upload progress is not supported.");
return XhrObj}})}else apexDropzone.sleepUntil(g),a.processQueue()}}(e);n.readAsArrayBuffer(e)}},deleteDzFile:function(b,a,c,d,h){a=[];var g=[];d&&(a=apexDropzone.buildPageItemsArray(d),g=apexDropzone.buildPageItemValuesArray(a));apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"DELETE",x02:c.name,p_arg_names:a,p_arg_values:g,p_request:"PLUGIN="+h,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),
p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(a){0<=a.indexOf("sqlerrm")?apex.event.trigger("#"+b,"dropzone-delete-error",a):apex.event.trigger("#"+b,"dropzone-delete-success",a)},error:function(a,c){apex.event.trigger("#"+b,"dropzone-delete-error",c)}})},apexDropzoneFnc:function(b,a,c){var d=jQuery("#"+apex.util.escapeCSS(b+"_dropzone"),apex.gPageContext$),h=apex.util.escapeCSS(b+"_dropzone");c=apexDropzone.parseBoolean(c);var g=apexDropzone.parseBoolean(a.clickable),k=parseFloat(a.maxFilesize),
m=apexDropzone.parseBoolean(a.removeAfterUpload),e=parseInt(a.maxFiles),n=apexDropzone.parseBoolean(a.supportCopyPaste),r=parseInt(a.waitTime),t=parseInt(a.parallelUploads),l=apexDropzone.parseBoolean(a.commonFilePreview),p=apexDropzone.parseBoolean(a.deleteFiles),q=a.pageItems;c&&(console.log("dropzoneApex: vOptions.ajaxIdentifier:",a.ajaxIdentifier),console.log("dropzoneApex: vOptions.pageItems:",a.pageItems),console.log("dropzoneApex: vOptions.maxFilesize:",a.maxFilesize),console.log("dropzoneApex: vOptions.clickable:",
a.clickable),console.log("dropzoneApex: vOptions.removeAfterUpload:",a.removeAfterUpload),console.log("dropzoneApex: vOptions.defaultMessage:",a.defaultMessage),console.log("dropzoneApex: vOptions.acceptedFiles:",a.acceptedFiles),console.log("dropzoneApex: vOptions.maxFiles:",a.maxFiles),console.log("dropzoneApex: vOptions.parallelUploads:",a.parallelUploads),console.log("dropzoneApex: vOptions.refreshRegionID:",a.refreshRegionID),console.log("dropzoneApex: vOptions.supportCopyPaste:",a.supportCopyPaste),
console.log("dropzoneApex: vOptions.waitTime:",a.waitTime),console.log("dropzoneApex: vOptions.commonFilePreview:",a.commonFilePreview),console.log("dropzoneApex: vOptions.callbackEvent:",a.callbackEvent),console.log("dropzoneApex: vOptions.callbackFnc:",a.callbackFnc),console.log("dropzoneApex: vOptions.pluginPrefix:",a.pluginPrefix),console.log("dropzoneApex: vOptions.fileTooBigMessage:",a.fileTooBigMessage),console.log("dropzoneApex: vOptions.maxFilesMessage:",a.maxFilesMessage),console.log("dropzoneApex: vOptions.deleteFiles:",
a.deleteFiles),console.log("dropzoneApex: vOptions.cancelUploadMessage:",a.cancelUploadMessage),console.log("dropzoneApex: vOptions.removeFileMessage:",a.removeFileMessage),console.log("dropzoneApex: pRegionId:",b),console.log("dropzoneApex: vRegion:",h),console.log("dropzoneApex: vRegion$:",d));Dropzone.autoDiscover=!1;var f=new Dropzone("div#"+h,{url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",addRemoveLinks:p,parallelUploads:t,uploadMultiple:!1,autoProcessQueue:!0,
maxFilesize:k,dictDefaultMessage:a.defaultMessage,clickable:g,maxFiles:e,acceptedFiles:a.acceptedFiles,dictFileTooBig:a.fileTooBigMessage,dictMaxFilesExceeded:a.maxFilesMessage,dictCancelUpload:a.cancelUploadMessage,dictRemoveFile:a.removeFileMessage});g||$(".dz-hidden-input").prop("disabled",!0);n&&FileReaderJS.setupClipboard(document.body,{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(a,b){f.addFile(b)}}});f.uploadFiles=function(c){apexDropzone.uploadDzFiles(b,f,c,q,a.ajaxIdentifier,
r)};if(p)f.on("removedfile",function(c){apexDropzone.deleteDzFile(b,f,c,q,a.ajaxIdentifier)});f.on("addedfile",function(c){apex.event.trigger("#"+b,"dropzone-added-file",c);if(l&&!c.type.match(/image.*/)){var d=c.name.split(".").pop();apexDropzone.imageExists(a.pluginPrefix+"img/"+d+".png",function(){$(c.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/"+d+".png")},function(){$(c.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/other.png")})}if("ADDEDFILE"==
a.callbackEvent)try{var e="return "+a.callbackFnc.replace(/;+$/,"")+";",f=(new Function(e))();apexDropzone.doCallback(f(c))}catch(g){console.log(g)}});f.on("maxfilesexceeded",function(a){apex.event.trigger("#"+b,"dropzone-maxfiles-exceeded",a)});f.on("complete",function(){if(0===f.getQueuedFiles().length&&0===f.getUploadingFiles().length){apex.event.trigger("#"+b,"dropzone-upload-complete");if("COMPLETE"==a.callbackEvent)try{var c="return "+a.callbackFnc.replace(/;+$/,"")+";",d=(new Function(c))();
apexDropzone.doCallback(d())}catch(e){console.log(e)}m&&setTimeout(function(){f.removeAllFiles()},3E3);a.refreshRegionID&&setTimeout(function(){apex.event.trigger("#"+a.refreshRegionID,"apexrefresh")},2E3)}})}};
