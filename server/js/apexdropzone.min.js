var apexDropzone={parseBoolean:function(b){var a;"true"==b.toLowerCase()&&(a=!0);"false"==b.toLowerCase()&&(a=!1);"true"!=b.toLowerCase()&&"false"!=b.toLowerCase()&&(a=void 0);return a},imageExists:function(b,a,f){try{var d=new Image;d.onload=a;d.onerror=f;d.src=b}catch(g){console.log(g)}},clob2Array:function(b,a,f){loopCount=Math.floor(b.length/a)+1;for(var d=0;d<loopCount;d++)f.push(b.slice(a*d,a*(d+1)));return f},binaryArray2base64:function(b){var a="";b=new Uint8Array(b);for(var f=b.byteLength,
d=0;d<f;d++)a+=String.fromCharCode(b[d]);return btoa(a)},sleepUntil:function(b){for(var a=(new Date).getTime();new Date<a+b;);return!0},setUploadProgress:function(b,a,f){b||(b=window.event);b.lengthComputable&&(b=b.loaded/b.total*100,a.emit("uploadprogress",f,b,f.size/(100/b)))},setUploadProgressChunked:function(b,a,f,d){b=b/a*100;f.emit("uploadprogress",d,b,d.size/(100/b))},asyncLoop:function(b,a,f){var d=1,g=!1,c={next:function(){g||(d<=b?(d++,a(c)):(g=!0,f()))},iteration:function(){return d-1},
"break":function(){g=!0;f()}};c.next();return c},uploadDzFiles:function(b,a,f,d,g){for(var c=0;c<f.length;c++){var e=f[c],h=new FileReader;h.onload=function(c){return function(f){if(c){f=apexDropzone.binaryArray2base64(f.target.result);var l=[],l=apexDropzone.clob2Array(f,3E4,l);a.emit("uploadprogress",e,10,e.size/10);e.xhr=apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",
x02:e.name,x03:e.type,f01:l,p_request:"PLUGIN="+d,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(f){apexDropzone.sleepUntil(g);var d;try{d=jQuery.parseJSON(f)}catch(c){apex.debug.log("uploadDzFiles Response ParseError",c),d=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFiles Response ParseError", "code": "AJAX Callback (pData) ParseError" }')}"error"==d.status?(apex.debug.log("uploadDzFiles Error",d.message,d.code),
apex.event.trigger("#"+b,"dropzone-upload-error",d),e.status=Dropzone.ERROR,a.emit("error",e,"Database error during file upload")):"success"==d.status&&(apex.debug.log("uploadDzFiles Success",d.message),apex.event.trigger("#"+b,"dropzone-upload-success",f),e.status=Dropzone.SUCCESS,a.emit("success",e,"success",null));a.emit("uploadprogress",e,100,e.size);a.emit("complete",e);a.processQueue()},error:function(d,f){apexDropzone.sleepUntil(g);apex.debug.log("uploadDzFiles Error",f);apex.event.trigger("#"+
b,"dropzone-upload-error",f);e.status=Dropzone.ERROR;a.emit("error",e,f?f:"Error processing file",d);a.emit("complete",e);a.processQueue()},xhr:function(){XhrObj=$.ajaxSettings.xhr();XhrObj.upload?XhrObj.upload.addEventListener("progress",function(b){apexDropzone.setUploadProgress(b,a,e)},!1):console.log("Upload progress is not supported.");return XhrObj}})}else apexDropzone.sleepUntil(g),a.processQueue()}}(e);h.readAsArrayBuffer(e)}},uploadDzFilesChunked:function(b,a,f,d,g){for(var c=0;c<f.length;c++){var e=
f[c],h=new FileReader;h.onload=function(f){return function(c){if(f){var l,m,h,p,n=Math.ceil(e.size/1048576);apexDropzone.asyncLoop(n,function(f){m=f.iteration();h=1048576*(m-1);p=h+1048576;apex.debug.log(e.name+" currentChunk",m);apex.debug.log(e.name+" chunkStart",h);apex.debug.log(e.name+" chunkEnd",p);l=e.slice(h,p);var c=new FileReader;c.onload=function(c){return function(c){c=apexDropzone.binaryArray2base64(c.target.result);e.xhr=apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,
window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",x02:e.name,x03:e.type,x04:m,x05:n,p_clob_01:c,p_request:"PLUGIN="+d,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(d){m==n&&apexDropzone.sleepUntil(g);var c;try{c=jQuery.parseJSON(d)}catch(h){apex.debug.log("uploadDzFilesChunked Response ParseError",h),c=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFilesChunked Response ParseError", "code": "AJAX Callback (pData) ParseError" }')}"error"==
c.status?(apex.debug.log("uploadDzFilesChunked Error",c.message,c.code),apex.event.trigger("#"+b,"dropzone-upload-chunk-error",c),e.status=Dropzone.ERROR,a.emit("error",e,"Database error during file upload"),a.emit("complete",e),a.processQueue()):"success"==c.status&&(apex.debug.log("uploadDzFilesChunked Success",c.message),apex.event.trigger("#"+b,"dropzone-upload-chunk-success",d),apexDropzone.setUploadProgressChunked(m,n,a,e),m==n&&(e.status=Dropzone.SUCCESS,a.emit("success",e,"success",null),
a.emit("complete",e),a.processQueue()));f.next()},error:function(c,d){apexDropzone.sleepUntil(g);apex.debug.log("uploadDzFilesChunked Error",d);apex.event.trigger("#"+b,"dropzone-upload-chunk-error",d);e.status=Dropzone.ERROR;a.emit("error",e,d?d:"Error processing file",c);a.emit("complete",e);a.processQueue()}})}}(l);c.readAsArrayBuffer(l)},function(){apex.debug.log("uploadDzFilesChunked Loop ended")})}else apexDropzone.sleepUntil(g),a.processQueue()}}(e);h.readAsArrayBuffer(e)}},deleteDzFile:function(b,
a,f,d){apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"DELETE",x02:f.name,p_request:"PLUGIN="+d,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(a){var c;try{c=jQuery.parseJSON(a)}catch(d){apex.debug.log("deleteDzFile Response ParseError",d),c=jQuery.parseJSON('{ "status": "error", "message": "deleteDzFile Response ParseError", "code": "AJAX Callback (pData) ParseError" }')}"error"==
c.status?(apex.debug.log("deleteDzFile Error",c.message,c.code),apex.event.trigger("#"+b,"dropzone-delete-error",c)):"success"==c.status&&(apex.debug.log("deleteDzFile Success",c.message),apex.event.trigger("#"+b,"dropzone-delete-success",a))},error:function(a,c){apex.debug.log("deleteDzFile Error",c);apex.event.trigger("#"+b,"dropzone-delete-error",c)}})},apexDropzoneFnc:function(b,a){var f=jQuery("#"+apex.util.escapeCSS(b+"_dropzone"),apex.gPageContext$),d=apex.util.escapeCSS(b+"_dropzone"),g=a.ajaxIdentifier,
c=parseFloat(a.maxFilesize),e=parseInt(a.maxFiles),h=parseInt(a.parallelUploads),r=a.acceptedFiles,q=parseInt(a.waitTime),l=a.uploadMechanism,m=apexDropzone.parseBoolean(a.clickable),t=apexDropzone.parseBoolean(a.showFilePreview),p=apexDropzone.parseBoolean(a.supportCopyPaste),n=apexDropzone.parseBoolean(a.removeAfterUpload),u=apexDropzone.parseBoolean(a.deleteFiles),C=a.pluginPrefix,v=a.displayMessage,w=a.fileTooBigMessage,x=a.maxFilesMessage,y=a.removeFileMessage,z=a.cancelUploadMessage,A=a.cancelUploadConfirmMessage,
B=a.invalidFileTypeMessage;apex.debug.log("apexDropzoneFnc - pRegionId",b);apex.debug.log("apexDropzoneFnc - pOptions",a);apex.debug.log("apexDropzoneFnc - vRegion",d);apex.debug.log("apexDropzoneFnc - vRegion$",f);apex.debug.log("apexDropzoneFnc - vAjaxIdentifier",g);apex.debug.log("apexDropzoneFnc - vMaxFileSize",c);apex.debug.log("apexDropzoneFnc - vMaxFiles",e);apex.debug.log("apexDropzoneFnc - vParallelUploads",h);apex.debug.log("apexDropzoneFnc - vAcceptedFiles",r);apex.debug.log("apexDropzoneFnc - vWaitTime",
q);apex.debug.log("apexDropzoneFnc - vUploadMechanism",l);apex.debug.log("apexDropzoneFnc - vClickable",m);apex.debug.log("apexDropzoneFnc - vShowFilePreview",t);apex.debug.log("apexDropzoneFnc - vCopyPaste",p);apex.debug.log("apexDropzoneFnc - vRemoveAfterUpload",n);apex.debug.log("apexDropzoneFnc - vPluginPrefix",C);apex.debug.log("apexDropzoneFnc - vDisplayMessage",v);apex.debug.log("apexDropzoneFnc - vFileTooBigMessage",w);apex.debug.log("apexDropzoneFnc - vMaxFilesMessage",x);apex.debug.log("apexDropzoneFnc - vRemoveFileMessage",
y);apex.debug.log("apexDropzoneFnc - vCancelUploadMessage",z);apex.debug.log("apexDropzoneFnc - vCancelUploadConfirmMessage",A);apex.debug.log("apexDropzoneFnc - vInvalidFileTypeMessage",B);Dropzone.autoDiscover=!1;var k=new Dropzone("div#"+d,{url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",uploadMultiple:!1,autoProcessQueue:!0,addRemoveLinks:u,parallelUploads:h,maxFilesize:c,clickable:m,maxFiles:e,acceptedFiles:r,dictDefaultMessage:v,dictFileTooBig:w,dictMaxFilesExceeded:x,
dictRemoveFile:y,dictCancelUpload:z,dictCancelUploadConfirmation:A,dictInvalidFileType:B});m||$(".dz-hidden-input").prop("disabled",!0);p&&FileReaderJS.setupClipboard(document.body,{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(a,b){k.addFile(b)}}});k.uploadFiles=function(a){"NORMAL"==l?apexDropzone.uploadDzFiles(b,k,a,g,q):"CHUNKED"==l&&apexDropzone.uploadDzFilesChunked(b,k,a,g,q)};if(u)k.on("removedfile",function(a){apex.event.trigger("#"+b,"dropzone-deleted-file",a);apexDropzone.deleteDzFile(b,
k,a,g)});k.on("addedfile",function(c){apex.event.trigger("#"+b,"dropzone-added-file",c);if(t&&!c.type.match(/image.*/)){var d=c.name.split(".").pop();apexDropzone.imageExists(a.pluginPrefix+"img/"+d+".png",function(){$(c.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/"+d+".png")},function(){$(c.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/other.png")})}});k.on("maxfilesexceeded",function(a){apex.event.trigger("#"+b,"dropzone-maxfiles-exceeded",a)});k.on("totaluploadprogress",
function(a){apex.event.trigger("#"+b,"dropzone-totalupload-progress",a)});k.on("complete",function(){0===k.getQueuedFiles().length&&0===k.getUploadingFiles().length&&(apex.event.trigger("#"+b,"dropzone-upload-complete"),n&&setTimeout(function(){k.removeAllFiles()},3E3))})}};
