var apexDropzone={parseBoolean:function(c){var a;"true"==c.toLowerCase()&&(a=!0);"false"==c.toLowerCase()&&(a=!1);"true"!=c.toLowerCase()&&"false"!=c.toLowerCase()&&(a=void 0);return a},imageExists:function(c,a,d){try{var b=new Image;b.onload=a;b.onerror=d;b.src=c}catch(g){console.log(g)}},clob2Array:function(c,a,d){loopCount=Math.floor(c.length/a)+1;for(var b=0;b<loopCount;b++)d.push(c.slice(a*b,a*(b+1)));return d},binaryArray2base64:function(c){var a="";c=new Uint8Array(c);for(var d=c.byteLength,
b=0;b<d;b++)a+=String.fromCharCode(c[b]);return btoa(a)},sleepUntil:function(c){for(var a=(new Date).getTime();new Date<a+c;);return!0},setUploadProgress:function(c,a,d){c||(c=window.event);c.lengthComputable&&(c=c.loaded/c.total*100,a.emit("uploadprogress",d,c,d.size/(100/c)))},setUploadProgressChunked:function(c,a,d,b){c=c/a*100;d.emit("uploadprogress",b,c,b.size/(100/c))},asyncLoop:function(c,a,d){var b=0,g=!1,f={next:function(){g||(b<c?(b++,a(f)):(g=!0,d()))},iteration:function(){return b-1},
"break":function(){g=!0;d()}};f.next();return f},uploadDzFiles:function(c,a,d,b,g){for(var f=0;f<d.length;f++){var e=d[f],l=new FileReader;l.onload=function(f){return function(d){if(f){d=apexDropzone.binaryArray2base64(d.target.result);var h=[],h=apexDropzone.clob2Array(d,3E4,h);a.emit("uploadprogress",e,10,e.size/10);apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",x02:e.name,
x03:e.type,f01:h,p_request:"PLUGIN="+b,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(d){apexDropzone.sleepUntil(g);var b;try{b=jQuery.parseJSON(d)}catch(f){apex.debug.log("uploadDzFiles Response ParseError",f),b=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFiles Response ParseError" }')}"error"==b.status?(apex.debug.log("uploadDzFiles Error",b.message),apex.event.trigger("#"+c,"dropzone-upload-error",b.message),
e.status=Dropzone.ERROR,a.emit("error",e,"Database error during file upload")):"success"==b.status&&(apex.debug.log("uploadDzFiles Success",b.message),apex.event.trigger("#"+c,"dropzone-upload-success",d),e.status=Dropzone.SUCCESS,a.emit("success",e,"success",null));a.emit("uploadprogress",e,100,e.size);a.emit("complete",e);a.processQueue()},error:function(b,d){apexDropzone.sleepUntil(g);apex.debug.log("uploadDzFiles Error",d);apex.event.trigger("#"+c,"dropzone-upload-error",d);e.status=Dropzone.ERROR;
a.emit("error",e,d?d:"Error processing file",b);a.emit("complete",e);a.processQueue()},xhr:function(){XhrObj=$.ajaxSettings.xhr();XhrObj.upload?XhrObj.upload.addEventListener("progress",function(c){apexDropzone.setUploadProgress(c,a,e)},!1):console.log("Upload progress is not supported.");return XhrObj}})}else apexDropzone.sleepUntil(g),a.processQueue()}}(e);l.readAsArrayBuffer(e)}},uploadDzFilesChunked:function(c,a,d,b,g){for(var f=0;f<d.length;f++){var e=d[f],l=new FileReader;l.onload=function(d){return function(f){if(d){f=
apexDropzone.binaryArray2base64(f.target.result);var h=[],l,m,h=apexDropzone.clob2Array(f,1048576,h),n=h.length;a.emit("uploadprogress",e,10,e.size/10);apexDropzone.asyncLoop(n,function(d){m=d.iteration();l=h[m];apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",x02:e.name,x03:e.type,x04:m,x05:n,p_clob_01:l,p_request:"PLUGIN="+b,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),
p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(b){m==n-1&&apexDropzone.sleepUntil(g);var f;try{f=jQuery.parseJSON(b)}catch(h){apex.debug.log("uploadDzFilesChunked Response ParseError",h),f=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFilesChunked Response ParseError" }')}"error"==f.status?(apex.debug.log("uploadDzFilesChunked Error",f.message),apex.event.trigger("#"+c,"dropzone-upload-chunk-error",f.message),e.status=Dropzone.ERROR,a.emit("error",e,"Database error during file upload"),
a.emit("complete",e),a.processQueue()):"success"==f.status&&(apex.debug.log("uploadDzFilesChunked Success",f.message),apex.event.trigger("#"+c,"dropzone-upload-chunk-success",b),apexDropzone.setUploadProgressChunked(m,n,a,e),m==n-1&&(e.status=Dropzone.SUCCESS,a.emit("success",e,"success",null),a.emit("complete",e),a.processQueue()));d.next()},error:function(d,b){apexDropzone.sleepUntil(g);apex.debug.log("uploadDzFilesChunked Error",b);apex.event.trigger("#"+c,"dropzone-upload-chunk-error",b);e.status=
Dropzone.ERROR;a.emit("error",e,b?b:"Error processing file",d);a.emit("complete",e);a.processQueue()}})},function(){apex.debug.log("uploadDzFilesChunked Loop ended")})}else apexDropzone.sleepUntil(g),a.processQueue()}}(e);l.readAsArrayBuffer(e)}},deleteDzFile:function(c,a,d,b){apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"DELETE",x02:d.name,p_request:"PLUGIN="+b,p_flow_id:$v("pFlowId"),
p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(a){var b;try{b=jQuery.parseJSON(a)}catch(d){apex.debug.log("deleteDzFile Response ParseError",d),b=jQuery.parseJSON('{ "status": "error", "message": "deleteDzFile Response ParseError" }')}"error"==b.status?(apex.debug.log("deleteDzFile Error",b.message),apex.event.trigger("#"+c,"dropzone-delete-error",b.message)):"success"==b.status&&(apex.debug.log("deleteDzFile Success",b.message),apex.event.trigger("#"+
c,"dropzone-delete-success",a))},error:function(a,b){apex.debug.log("deleteDzFile Error",b);apex.event.trigger("#"+c,"dropzone-delete-error",b)}})},apexDropzoneFnc:function(c,a){var d=jQuery("#"+apex.util.escapeCSS(c+"_dropzone"),apex.gPageContext$),b=apex.util.escapeCSS(c+"_dropzone"),g=a.ajaxIdentifier,f=parseFloat(a.maxFilesize),e=parseInt(a.maxFiles),l=parseInt(a.parallelUploads),r=a.acceptedFiles,p=parseInt(a.waitTime),h=a.uploadMechanism,q=apexDropzone.parseBoolean(a.clickable),m=apexDropzone.parseBoolean(a.showFilePreview),
n=apexDropzone.parseBoolean(a.supportCopyPaste),t=apexDropzone.parseBoolean(a.removeAfterUpload),u=apexDropzone.parseBoolean(a.deleteFiles),C=a.pluginPrefix,v=a.displayMessage,w=a.fileTooBigMessage,x=a.maxFilesMessage,y=a.removeFileMessage,z=a.cancelUploadMessage,A=a.cancelUploadConfirmMessage,B=a.invalidFileTypeMessage;apex.debug.log("apexDropzoneFnc - pRegionId",c);apex.debug.log("apexDropzoneFnc - pOptions",a);apex.debug.log("apexDropzoneFnc - vRegion",b);apex.debug.log("apexDropzoneFnc - vRegion$",
d);apex.debug.log("apexDropzoneFnc - vAjaxIdentifier",g);apex.debug.log("apexDropzoneFnc - vMaxFileSize",f);apex.debug.log("apexDropzoneFnc - vMaxFiles",e);apex.debug.log("apexDropzoneFnc - vParallelUploads",l);apex.debug.log("apexDropzoneFnc - vAcceptedFiles",r);apex.debug.log("apexDropzoneFnc - vWaitTime",p);apex.debug.log("apexDropzoneFnc - vUploadMechanism",h);apex.debug.log("apexDropzoneFnc - vClickable",q);apex.debug.log("apexDropzoneFnc - vShowFilePreview",m);apex.debug.log("apexDropzoneFnc - vCopyPaste",
n);apex.debug.log("apexDropzoneFnc - vRemoveAfterUpload",t);apex.debug.log("apexDropzoneFnc - vPluginPrefix",C);apex.debug.log("apexDropzoneFnc - vDisplayMessage",v);apex.debug.log("apexDropzoneFnc - vFileTooBigMessage",w);apex.debug.log("apexDropzoneFnc - vMaxFilesMessage",x);apex.debug.log("apexDropzoneFnc - vRemoveFileMessage",y);apex.debug.log("apexDropzoneFnc - vCancelUploadMessage",z);apex.debug.log("apexDropzoneFnc - vCancelUploadConfirmMessage",A);apex.debug.log("apexDropzoneFnc - vInvalidFileTypeMessage",
B);Dropzone.autoDiscover=!1;var k=new Dropzone("div#"+b,{url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",uploadMultiple:!1,autoProcessQueue:!0,addRemoveLinks:u,parallelUploads:l,maxFilesize:f,clickable:q,maxFiles:e,acceptedFiles:r,dictDefaultMessage:v,dictFileTooBig:w,dictMaxFilesExceeded:x,dictRemoveFile:y,dictCancelUpload:z,dictCancelUploadConfirmation:A,dictInvalidFileType:B});q||$(".dz-hidden-input").prop("disabled",!0);n&&FileReaderJS.setupClipboard(document.body,
{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(a,c){k.addFile(c)}}});k.uploadFiles=function(a){"NORMAL"==h?apexDropzone.uploadDzFiles(c,k,a,g,p):"CHUNKED"==h&&apexDropzone.uploadDzFilesChunked(c,k,a,g,p)};if(u)k.on("removedfile",function(a){apex.event.trigger("#"+c,"dropzone-deleted-file",a);apexDropzone.deleteDzFile(c,k,a,g)});k.on("addedfile",function(b){apex.event.trigger("#"+c,"dropzone-added-file",b);if(m&&!b.type.match(/image.*/)){var d=b.name.split(".").pop();apexDropzone.imageExists(a.pluginPrefix+
"img/"+d+".png",function(){$(b.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/"+d+".png")},function(){$(b.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/other.png")})}});k.on("maxfilesexceeded",function(a){apex.event.trigger("#"+c,"dropzone-maxfiles-exceeded",a)});k.on("totaluploadprogress",function(a){apex.event.trigger("#"+c,"dropzone-totalupload-progress",a)});k.on("complete",function(){0===k.getQueuedFiles().length&&0===k.getUploadingFiles().length&&
(apex.event.trigger("#"+c,"dropzone-upload-complete"),t&&setTimeout(function(){k.removeAllFiles()},3E3))})}};
