var apexDropzone={parseBoolean:function(c){var a;"true"==c.toLowerCase()&&(a=!0);"false"==c.toLowerCase()&&(a=!1);"true"!=c.toLowerCase()&&"false"!=c.toLowerCase()&&(a=void 0);return a},imageExists:function(c,a,d){try{var b=new Image;b.onload=a;b.onerror=d;b.src=c}catch(h){console.log(h)}},clob2Array:function(c,a,d){loopCount=Math.floor(c.length/a)+1;for(var b=0;b<loopCount;b++)d.push(c.slice(a*b,a*(b+1)));return d},binaryArray2base64:function(c){var a="";c=new Uint8Array(c);for(var d=c.byteLength,
b=0;b<d;b++)a+=String.fromCharCode(c[b]);return btoa(a)},sleepUntil:function(c){for(var a=(new Date).getTime();new Date<a+c;);return!0},setUploadProgress:function(c,a,d){c||(c=window.event);c.lengthComputable&&(c=c.loaded/c.total*100,a.emit("uploadprogress",d,c,d.size/(100/c)))},setUploadProgressChunked:function(c,a,d,b){c=c/a*100;d.emit("uploadprogress",b,c,b.size/(100/c))},createThumbnail:function(c,a,d,b,h){c.createThumbnail(a,function(){if(d&&!a.type.match(/image.*/)){var c=a.name.split(".").pop();
apexDropzone.imageExists(b+"img/"+c+".png",function(){$(a.previewElement).find(".dz-image img").attr("src",b+"img/"+c+".png")},function(){$(a.previewElement).find(".dz-image img").attr("src",b+"img/other.png")})}h()})},uploadDzFiles:function(c,a,d,b,h){for(var k=0;k<d.length;k++){var e=d[k],g=new FileReader;g.onload=function(d){return function(k){if(d){k=apexDropzone.binaryArray2base64(k.target.result);var g=[],g=apexDropzone.clob2Array(k,3E4,g);a.emit("uploadprogress",e,10,e.size/10);apex.jQuery.ajax({dataType:"text",
type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,traditional:!0,data:{x01:"UPLOAD",x02:e.name,x03:e.type,f01:g,p_request:"PLUGIN="+b,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(b){apexDropzone.sleepUntil(h);var d;try{d=jQuery.parseJSON(b)}catch(k){apex.debug.log("uploadDzFiles Response ParseError",k),d=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFiles Response ParseError" }')}"error"==
d.status?(apex.debug.log("uploadDzFiles Error",d.message),apex.event.trigger("#"+c,"dropzone-upload-error",d.message),e.status=Dropzone.ERROR,a.emit("error",e,"Database error during file upload")):"success"==d.status&&(apex.debug.log("uploadDzFiles Success",d.message),apex.event.trigger("#"+c,"dropzone-upload-success",b),e.status=Dropzone.SUCCESS,a.emit("success",e,"success",null));a.emit("uploadprogress",e,100,e.size);a.emit("complete",e);a.processQueue()},error:function(d,b){apexDropzone.sleepUntil(h);
apex.debug.log("uploadDzFiles Error",b);apex.event.trigger("#"+c,"dropzone-upload-error",b);e.status=Dropzone.ERROR;a.emit("error",e,b?b:"Error processing file",d);a.emit("complete",e);a.processQueue()},xhr:function(){XhrObj=$.ajaxSettings.xhr();XhrObj.upload?XhrObj.upload.addEventListener("progress",function(c){apexDropzone.setUploadProgress(c,a,e)},!1):console.log("Upload progress is not supported.");return XhrObj}})}else apexDropzone.sleepUntil(h),a.processQueue()}}(e);g.readAsArrayBuffer(e)}},
uploadDzFilesChunked:function(c,a,d,b,h,k,e){for(var g=0;g<d.length;g++){var f=d[g],m=new FileReader;m.onload=function(d){return function(g){if(d){g=apexDropzone.binaryArray2base64(g.target.result);var n=[],m,p,n=apexDropzone.clob2Array(g,1048576,n),q=n.length;a.emit("uploadprogress",f,10,f.size/10);apexDropzone.createThumbnail(a,f,k,e,function(){for(var d=0;d<q;d++)m=n[d],p=d,apexDropzone.setUploadProgressChunked(p,q,a,f),apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,
window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!1,traditional:!0,data:{x01:"UPLOAD",x02:f.name,x03:f.type,x04:p,x05:q,p_clob_01:m,p_request:"PLUGIN="+b,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(d){p==q-1&&apexDropzone.sleepUntil(h);var b;try{b=jQuery.parseJSON(d)}catch(k){apex.debug.log("uploadDzFilesChunked Response ParseError",k),b=jQuery.parseJSON('{ "status": "error", "message": "uploadDzFilesChunked Response ParseError" }')}"error"==
b.status?(apex.debug.log("uploadDzFilesChunked Error",b.message),apex.event.trigger("#"+c,"dropzone-upload-chunk-error",b.message),f.status=Dropzone.ERROR,a.emit("error",f,"Database error during file upload"),a.emit("complete",f),a.processQueue()):"success"==b.status&&(apex.debug.log("uploadDzFilesChunked Success",b.message),apex.event.trigger("#"+c,"dropzone-upload-chunk-success",d),p==q-1&&(f.status=Dropzone.SUCCESS,a.emit("success",f,"success",null),a.emit("complete",f),a.processQueue()))},error:function(d,
b){apexDropzone.sleepUntil(h);apex.debug.log("uploadDzFilesChunked Error",b);apex.event.trigger("#"+c,"dropzone-upload-chunk-error",b);f.status=Dropzone.ERROR;a.emit("error",f,b?b:"Error processing file",d);a.emit("complete",f);a.processQueue()}})})}else apexDropzone.sleepUntil(h),a.processQueue()}}(f);m.readAsArrayBuffer(f)}},deleteDzFile:function(c,a,d,b){apex.jQuery.ajax({dataType:"text",type:"POST",url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",async:!0,
traditional:!0,data:{x01:"DELETE",x02:d.name,p_request:"PLUGIN="+b,p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId"),p_instance:$v("pInstance"),p_debug:$v("pdebug")},success:function(a){var b;try{b=jQuery.parseJSON(a)}catch(d){apex.debug.log("deleteDzFile Response ParseError",d),b=jQuery.parseJSON('{ "status": "error", "message": "deleteDzFile Response ParseError" }')}"error"==b.status?(apex.debug.log("deleteDzFile Error",b.message),apex.event.trigger("#"+c,"dropzone-delete-error",b.message)):
"success"==b.status&&(apex.debug.log("deleteDzFile Success",b.message),apex.event.trigger("#"+c,"dropzone-delete-success",a))},error:function(a,b){apex.debug.log("deleteDzFile Error",b);apex.event.trigger("#"+c,"dropzone-delete-error",b)}})},apexDropzoneFnc:function(c,a){var d=jQuery("#"+apex.util.escapeCSS(c+"_dropzone"),apex.gPageContext$),b=apex.util.escapeCSS(c+"_dropzone"),h=a.ajaxIdentifier,k=parseFloat(a.maxFilesize),e=parseInt(a.maxFiles),g=parseInt(a.parallelUploads),f=a.acceptedFiles,m=
parseInt(a.waitTime),r=a.uploadMechanism,t=apexDropzone.parseBoolean(a.clickable),n=apexDropzone.parseBoolean(a.showFilePreview),u=apexDropzone.parseBoolean(a.supportCopyPaste),p=apexDropzone.parseBoolean(a.removeAfterUpload),q=apexDropzone.parseBoolean(a.deleteFiles),v=a.pluginPrefix,w=a.displayMessage,x=a.fileTooBigMessage,y=a.maxFilesMessage,z=a.removeFileMessage,A=a.cancelUploadMessage,B=a.cancelUploadConfirmMessage,C=a.invalidFileTypeMessage;apex.debug.log("apexDropzoneFnc - pRegionId",c);apex.debug.log("apexDropzoneFnc - pOptions",
a);apex.debug.log("apexDropzoneFnc - vRegion",b);apex.debug.log("apexDropzoneFnc - vRegion$",d);apex.debug.log("apexDropzoneFnc - vAjaxIdentifier",h);apex.debug.log("apexDropzoneFnc - vMaxFileSize",k);apex.debug.log("apexDropzoneFnc - vMaxFiles",e);apex.debug.log("apexDropzoneFnc - vParallelUploads",g);apex.debug.log("apexDropzoneFnc - vAcceptedFiles",f);apex.debug.log("apexDropzoneFnc - vWaitTime",m);apex.debug.log("apexDropzoneFnc - vUploadMechanism",r);apex.debug.log("apexDropzoneFnc - vClickable",
t);apex.debug.log("apexDropzoneFnc - vShowFilePreview",n);apex.debug.log("apexDropzoneFnc - vCopyPaste",u);apex.debug.log("apexDropzoneFnc - vRemoveAfterUpload",p);apex.debug.log("apexDropzoneFnc - vPluginPrefix",v);apex.debug.log("apexDropzoneFnc - vDisplayMessage",w);apex.debug.log("apexDropzoneFnc - vFileTooBigMessage",x);apex.debug.log("apexDropzoneFnc - vMaxFilesMessage",y);apex.debug.log("apexDropzoneFnc - vRemoveFileMessage",z);apex.debug.log("apexDropzoneFnc - vCancelUploadMessage",A);apex.debug.log("apexDropzoneFnc - vCancelUploadConfirmMessage",
B);apex.debug.log("apexDropzoneFnc - vInvalidFileTypeMessage",C);Dropzone.autoDiscover=!1;var l=new Dropzone("div#"+b,{url:window.location.href.substr(0,window.location.href.indexOf("/f?p=")+1)+"wwv_flow.show",uploadMultiple:!1,autoProcessQueue:!0,addRemoveLinks:q,parallelUploads:g,maxFilesize:k,clickable:t,maxFiles:e,acceptedFiles:f,dictDefaultMessage:w,dictFileTooBig:x,dictMaxFilesExceeded:y,dictRemoveFile:z,dictCancelUpload:A,dictCancelUploadConfirmation:B,dictInvalidFileType:C});t||$(".dz-hidden-input").prop("disabled",
!0);u&&FileReaderJS.setupClipboard(document.body,{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(a,c){l.addFile(c)}}});l.uploadFiles=function(a){"NORMAL"==r?apexDropzone.uploadDzFiles(c,l,a,h,m):"CHUNKED"==r&&apexDropzone.uploadDzFilesChunked(c,l,a,h,m,n,v)};if(q)l.on("removedfile",function(a){apex.event.trigger("#"+c,"dropzone-deleted-file",a);apexDropzone.deleteDzFile(c,l,a,h)});l.on("addedfile",function(b){apex.event.trigger("#"+c,"dropzone-added-file",b);if(n&&!b.type.match(/image.*/)){var d=
b.name.split(".").pop();apexDropzone.imageExists(a.pluginPrefix+"img/"+d+".png",function(){$(b.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/"+d+".png")},function(){$(b.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/other.png")})}});l.on("maxfilesexceeded",function(a){apex.event.trigger("#"+c,"dropzone-maxfiles-exceeded",a)});l.on("totaluploadprogress",function(a){apex.event.trigger("#"+c,"dropzone-totalupload-progress",a)});l.on("complete",function(){0===
l.getQueuedFiles().length&&0===l.getUploadingFiles().length&&(apex.event.trigger("#"+c,"dropzone-upload-complete"),p&&setTimeout(function(){l.removeAllFiles()},3E3))})}};
