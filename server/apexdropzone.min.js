function parseBoolean(b){var a;"true"==b.toLowerCase()&&(a=!0);"false"==b.toLowerCase()&&(a=!1);"true"!=b.toLowerCase()&&"false"!=b.toLowerCase()&&(a=void 0);return a}function imageExists(b,a,f){var c=new Image;c.onload=a;c.onerror=f;c.src=b}function clob2Array(b,a,f){loopCount=Math.floor(b.length/a)+1;for(var c=0;c<loopCount;c++)f.push(b.slice(a*c,a*(c+1)));return f}
function binaryArray2base64(b){var a="";b=new Uint8Array(b);for(var f=b.byteLength,c=0;c<f;c++)a+=String.fromCharCode(b[c]);return btoa(a)}function sleep_until(b){for(var a=(new Date).getTime();new Date<a+b;);return!0}function doCallback(b){"function"===typeof b&&b()}
function apexDropzone(b,a,f){var c=jQuery("#"+apex.util.escapeCSS(b+"_dropzone"),apex.gPageContext$),h=apex.util.escapeCSS(b+"_dropzone");f=parseBoolean(f);var k=parseBoolean(a.clickable),l=parseInt(a.maxFilesize),m=parseBoolean(a.removeAfterUpload),n=parseInt(a.maxFiles),p=parseBoolean(a.supportCopyPaste),g=parseInt(a.waitTime),q=parseInt(a.parallelUploads),r=parseBoolean(a.commonFilePreview);f&&(console.log("dropzoneApex: vOptions.ajaxIdentifier:",a.ajaxIdentifier),console.log("dropzoneApex: vOptions.pageItems:",
a.pageItems),console.log("dropzoneApex: vOptions.maxFilesize:",a.maxFilesize),console.log("dropzoneApex: vOptions.clickable:",a.clickable),console.log("dropzoneApex: vOptions.removeAfterUpload:",a.removeAfterUpload),console.log("dropzoneApex: vOptions.defaultMessage:",a.defaultMessage),console.log("dropzoneApex: vOptions.acceptedFiles:",a.acceptedFiles),console.log("dropzoneApex: vOptions.maxFiles:",a.maxFiles),console.log("dropzoneApex: vOptions.parallelUploads:",a.parallelUploads),console.log("dropzoneApex: vOptions.refreshRegionID:",
a.refreshRegionID),console.log("dropzoneApex: vOptions.supportCopyPaste:",a.supportCopyPaste),console.log("dropzoneApex: vOptions.waitTime:",a.waitTime),console.log("dropzoneApex: vOptions.commonFilePreview:",a.commonFilePreview),console.log("dropzoneApex: vOptions.callbackEvent:",a.callbackEvent),console.log("dropzoneApex: vOptions.callbackFnc:",a.callbackFnc),console.log("dropzoneApex: vOptions.pluginPrefix:",a.pluginPrefix),console.log("dropzoneApex: vOptions.fileTooBigMessage:",a.fileTooBigMessage),
console.log("dropzoneApex: vOptions.maxFilesMessage:",a.maxFilesMessage),console.log("dropzoneApex: pRegionId:",b),console.log("dropzoneApex: vRegion:",h),console.log("dropzoneApex: vRegion$:",c));Dropzone.autoDiscover=!1;var d=new Dropzone("div#"+h,{paramName:"p_clob_01",url:"wwv_flow.show",params:{p_instance:$v("pInstance"),p_flow_id:$v("pFlowId"),p_flow_step_id:$v("pFlowStepId")},addRemoveLinks:!1,parallelUploads:q,uploadMultiple:!1,autoProcessQueue:!0,maxFilesize:l,dictDefaultMessage:a.defaultMessage,
clickable:k,maxFiles:n,acceptedFiles:a.acceptedFiles,dictFileTooBig:a.fileTooBigMessage,dictMaxFilesExceeded:a.maxFilesMessage});k||$(".dz-hidden-input").prop("disabled",!0);p&&FileReaderJS.setupClipboard(document.body,{readAsDefault:"DataURL",accept:{"image/*":"DataURL"},on:{load:function(a,b){d.addFile(b)}}});if(r)d.on("addedfile",function(d){$("#"+b).trigger("dropzone-added-file");if(!d.type.match(/image.*/)){var c=d.name.split(".").pop();imageExists(a.pluginPrefix+"img/"+c+".png",function(){$(d.previewElement).find(".dz-image img").attr("src",
a.pluginPrefix+"img/"+c+".png")},function(){$(d.previewElement).find(".dz-image img").attr("src",a.pluginPrefix+"img/other.png")})}if("ADDEDFILE"==a.callbackEvent){var e="return "+a.callbackFnc.replace(/;+$/,"")+";";(new Function(e))();e=(new Function(e))();doCallback(e(d))}});d.uploadFiles=function(b){for(var c=0;c<b.length;c++){var e=b[c];d.emit("uploadprogress",e,10,e.size/10);var f=new FileReader;f.onload=function(b){return function(c){if(b){c=binaryArray2base64(c.target.result);d.emit("uploadprogress",
e,25,e.size/4);var f=[],f=clob2Array(c,3E4,f);d.emit("uploadprogress",e,50,e.size/2);apex.server.plugin(a.ajaxIdentifier,{x01:e.name,x02:e.type,f01:f,pageItems:a.pageItems},{dataType:"html",success:function(){sleep_until(g);d.emit("uploadprogress",e,100,e.size);e.status=Dropzone.SUCCESS;d.emit("success",e,"success",null);d.emit("complete",e);d.processQueue()},error:function(a,b){sleep_until(g);e.status=Dropzone.ERROR;d.emit("error",e,null==b||void 0==b?"Error processing file.":b,a);d.emit("complete",
e);d.processQueue()}})}else sleep_until(g),d.processQueue()}}(e);f.readAsArrayBuffer(e)}};d.on("complete",function(){0==d.getQueuedFiles().length&&0==d.getUploadingFiles().length&&$("#"+b).trigger("dropzone-upload-complete");if("COMPLETE"==a.callbackEvent&&0==d.getQueuedFiles().length&&0==d.getUploadingFiles().length){var c="return "+a.callbackFnc.replace(/;+$/,"")+";";(new Function(c))();c=(new Function(c))();doCallback(c())}m&&0==d.getQueuedFiles().length&&0==d.getUploadingFiles().length&&setTimeout(function(){d.removeAllFiles()},
3E3);a.refreshRegionID&&0==d.getQueuedFiles().length&&0==d.getUploadingFiles().length&&setTimeout(function(){apex.event.trigger("#"+a.refreshRegionID,"apexrefresh")},3E3)})};
